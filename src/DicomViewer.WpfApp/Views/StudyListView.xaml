<UserControl x:Class="DicomViewer.WpfApp.Views.StudyListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewmodels="clr-namespace:DicomViewer.ViewModels;assembly=DicomViewer.ViewModels"
             mc:Ignorable="d"
             Background="#1E1E1E"
             d:DataContext="{d:DesignInstance Type=viewmodels:StudyListViewModel}">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 헤더 / Header -->
        <TextBlock Grid.Row="0"
                   Text="Study List"
                   FontSize="24"
                   FontWeight="Bold"
                   Foreground="White"
                   Margin="0,0,0,16" />

        <!-- 필터 영역 / Filter area -->
        <Border Grid.Row="1"
                Background="#252526"
                CornerRadius="4"
                Padding="16"
                Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Patient ID -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,16,8">
                    <TextBlock Text="Patient ID" Foreground="#999999" Margin="0,0,0,4" />
                    <TextBox Text="{Binding PatientIdFilter, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource DarkTextBoxStyle}" />
                </StackPanel>

                <!-- Patient Name -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,16,8">
                    <TextBlock Text="Patient Name" Foreground="#999999" Margin="0,0,0,4" />
                    <TextBox Text="{Binding PatientNameFilter, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource DarkTextBoxStyle}" />
                </StackPanel>

                <!-- 버튼들 / Buttons -->
                <StackPanel Grid.Row="0" Grid.Column="2"
                            Grid.RowSpan="2"
                            VerticalAlignment="Center"
                            Orientation="Horizontal">
                    <Button Content="Open Folder"
                            Command="{Binding OpenFolderCommand}"
                            Style="{StaticResource ToolbarButtonStyle}"
                            Margin="0,0,8,0" />
                    <Button Content="Search"
                            Command="{Binding SearchStudiesCommand}"
                            Style="{StaticResource ToolbarButtonStyle}"
                            Margin="0,0,8,0" />
                    <Button Content="Clear"
                            Command="{Binding ClearFiltersCommand}"
                            Style="{StaticResource ToolbarButtonStyle}" />
                </StackPanel>

                <!-- 현재 경로 / Current path -->
                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                    <TextBlock Text="Current Path" Foreground="#999999" Margin="0,0,0,4" />
                    <TextBlock Text="{Binding CurrentPath}"
                               Foreground="White"
                               TextTrimming="CharacterEllipsis" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Study 목록 / Study list -->
        <Border Grid.Row="2"
                Background="#252526"
                CornerRadius="4">
            <Grid>
                <!-- 로딩 인디케이터 / Loading indicator -->
                <TextBlock Text="Loading..."
                           Foreground="White"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}" />

                <!-- Study 리스트 / Study list -->
                <ListBox ItemsSource="{Binding Studies}"
                         SelectedItem="{Binding SelectedStudy}"
                         Style="{StaticResource DarkListBoxStyle}"
                         ItemContainerStyle="{StaticResource DarkListBoxItemStyle}"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150" />
                                    <ColumnDefinition Width="200" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="80" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="{Binding PatientId}"
                                           Foreground="White"
                                           TextTrimming="CharacterEllipsis" />
                                <TextBlock Grid.Column="1"
                                           Text="{Binding PatientName}"
                                           Foreground="White"
                                           TextTrimming="CharacterEllipsis" />
                                <TextBlock Grid.Column="2"
                                           Text="{Binding StudyDescription}"
                                           Foreground="#999999"
                                           TextTrimming="CharacterEllipsis" />
                                <TextBlock Grid.Column="3"
                                           Text="{Binding StudyDate, StringFormat=yyyy-MM-dd}"
                                           Foreground="#999999" />
                                <TextBlock Grid.Column="4"
                                           Foreground="#999999">
                                    <Run Text="{Binding Series.Count, Mode=OneWay}" />
                                    <Run Text=" series" />
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- 더블클릭으로 Study 열기 / Double-click to open study -->
        <Grid.InputBindings>
            <MouseBinding MouseAction="LeftDoubleClick"
                          Command="{Binding OpenStudyCommand}" />
        </Grid.InputBindings>
    </Grid>
</UserControl>
