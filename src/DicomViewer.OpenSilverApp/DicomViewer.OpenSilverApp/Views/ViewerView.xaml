<UserControl x:Class="DicomViewer.OpenSilverApp.Views.ViewerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="#1E1E1E">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="80" />
        </Grid.ColumnDefinitions>

        <!-- ===== 왼쪽: 환자/시리즈 정보 / Left: Patient/Series info ===== -->
        <Border Grid.Column="0" Background="#252526">
            <StackPanel Margin="16">
                <!-- 환자 정보 카드 / Patient info card -->
                <Border Background="#2D2D30" CornerRadius="4" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Patient"
                                   Foreground="#888888"
                                   FontSize="11"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="{Binding PatientName}"
                                   Foreground="White"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Margin="0,8,0,0" />
                        <TextBlock Text="{Binding PatientId}"
                                   Foreground="#888888"
                                   FontSize="12"
                                   Margin="0,4,0,0" />
                    </StackPanel>
                </Border>

                <!-- Study 정보 / Study info -->
                <Border Background="#2D2D30" CornerRadius="4" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Study"
                                   Foreground="#888888"
                                   FontSize="11"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="{Binding StudyDescription}"
                                   Foreground="White"
                                   TextWrapping="Wrap"
                                   Margin="0,8,0,0" />
                    </StackPanel>
                </Border>

                <!-- Series 정보 / Series info -->
                <Border Background="#2D2D30" CornerRadius="4" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Series"
                                   Foreground="#888888"
                                   FontSize="11"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="{Binding SeriesDescription}"
                                   Foreground="White"
                                   TextWrapping="Wrap"
                                   Margin="0,8,0,0" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <!-- ===== 중앙: 이미지 뷰어 / Center: Image viewer ===== -->
        <Grid Grid.Column="1" Background="#1E1E1E">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 이미지 표시 영역 / Image display area -->
            <Border Grid.Row="0" Background="Black">
                <Grid>
                    <!-- 플레이스홀더 메시지 / Placeholder message -->
                    <TextBlock Text="{Binding ViewerMessage}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="#666666"
                               FontSize="14"
                               TextWrapping="Wrap"
                               TextAlignment="Center"
                               MaxWidth="400" />

                    <!-- 이미지 뷰어 (간단한 Image 컨트롤) / Image viewer (simple Image control) -->
                    <Image x:Name="DicomImage"
                           Stretch="Uniform"
                           RenderTransformOrigin="0.5,0.5">
                        <Image.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform ScaleX="{Binding ZoomFactor}"
                                                ScaleY="{Binding ZoomFactor}" />
                                <RotateTransform Angle="{Binding RotationAngle}" />
                                <TranslateTransform X="{Binding PanX}"
                                                    Y="{Binding PanY}" />
                            </TransformGroup>
                        </Image.RenderTransform>
                    </Image>

                    <!-- 로딩 인디케이터 / Loading indicator -->
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Border Width="48" Height="48"
                                CornerRadius="24"
                                Background="#0078D4" />
                        <TextBlock Text="Loading..."
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   Margin="0,12,0,0" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 슬라이스 슬라이더 / Slice slider -->
            <Border Grid.Row="1" Background="#2D2D30" Padding="16,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 현재 슬라이스 / Current slice (1-based for display) -->
                    <Border Grid.Column="0"
                            Background="#0078D4"
                            CornerRadius="4"
                            Padding="8,4"
                            MinWidth="40">
                        <TextBlock Text="{Binding SliceDisplayNumber}"
                                   Foreground="White"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center" />
                    </Border>

                    <!-- 슬라이더 / Slider -->
                    <Slider Grid.Column="1"
                            Minimum="0"
                            Maximum="{Binding MaxSliceIndex}"
                            Value="{Binding CurrentSliceIndex, Mode=TwoWay}"
                            VerticalAlignment="Center"
                            Margin="16,0" />

                    <!-- 총 슬라이스 / Total slices -->
                    <Border Grid.Column="2"
                            Background="#333333"
                            CornerRadius="4"
                            Padding="8,4"
                            MinWidth="40">
                        <TextBlock Text="{Binding TotalSliceCount}"
                                   Foreground="#AAAAAA"
                                   HorizontalAlignment="Center" />
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- ===== 오른쪽: 도구 패널 / Right: Tools panel ===== -->
        <Border Grid.Column="2" Background="#2D2D30">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="8">
                    <!-- 도구 섹션 / Tools section -->
                    <TextBlock Text="TOOLS"
                               Foreground="#888888"
                               FontSize="9"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8" />

                    <!-- Pan 버튼 / Pan button -->
                    <Button Content="Pan"
                            Command="{Binding SelectToolCommand}"
                            CommandParameter="Pan"
                            Padding="8,6"
                            Margin="0,2" />

                    <!-- Zoom 버튼 / Zoom button -->
                    <Button Content="Zoom"
                            Command="{Binding SelectToolCommand}"
                            CommandParameter="Zoom"
                            Padding="8,6"
                            Margin="0,2" />

                    <!-- W/L 버튼 / W/L button -->
                    <Button Content="W/L"
                            Command="{Binding SelectToolCommand}"
                            CommandParameter="WindowLevel"
                            Padding="8,6"
                            Margin="0,2" />

                    <Border Height="1" Background="#444444" Margin="0,8" />

                    <!-- 회전 버튼들 / Rotation buttons -->
                    <TextBlock Text="ROTATE"
                               Foreground="#888888"
                               FontSize="9"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Content="◀"
                                Command="{Binding RotateLeftCommand}"
                                Padding="8,6"
                                Margin="0,0,2,0" />
                        <Button Grid.Column="1"
                                Content="▶"
                                Command="{Binding RotateRightCommand}"
                                Padding="8,6"
                                Margin="2,0,0,0" />
                    </Grid>

                    <!-- Flip 버튼들 / Flip buttons -->
                    <Grid Margin="0,4,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Content="H"
                                Command="{Binding ToggleFlipHorizontalCommand}"
                                Padding="8,6"
                                Margin="0,0,2,0"
                                ToolTipService.ToolTip="Flip Horizontal" />
                        <Button Grid.Column="1"
                                Content="V"
                                Command="{Binding ToggleFlipVerticalCommand}"
                                Padding="8,6"
                                Margin="2,0,0,0"
                                ToolTipService.ToolTip="Flip Vertical" />
                    </Grid>

                    <Border Height="1" Background="#444444" Margin="0,8" />

                    <!-- Zoom 버튼들 / Zoom buttons -->
                    <TextBlock Text="ZOOM"
                               Foreground="#888888"
                               FontSize="9"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Content="+"
                                Command="{Binding ZoomInCommand}"
                                Padding="8,6"
                                Margin="0,0,2,0" />
                        <Button Grid.Column="1"
                                Content="-"
                                Command="{Binding ZoomOutCommand}"
                                Padding="8,6"
                                Margin="2,0,0,0" />
                    </Grid>

                    <Border Height="1" Background="#444444" Margin="0,8" />

                    <!-- Reset 버튼 / Reset button -->
                    <Button Content="Reset"
                            Command="{Binding ResetViewCommand}"
                            Padding="8,6"
                            Margin="0,2" />
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
